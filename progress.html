<!DOCTYPE html>
<html>
<head>
    <title>CTF Progress Tracker with Hints</title>
    <link rel="stylesheet" href="./style.css">
    <style>
        .challenge-box {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            background: #f9f9f9;
        }
        .challenge-box strong {
            font-size: 1.1em;
        }
        #resetBtn {
            background: #c0392b;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        #resetBtn:hover {
            background: #e74c3c;
        }
    </style>
</head>
<body>

<a href="index.html" id="backBtn">← Back to start</a>

<div class="container">
    <h1>CTF Progress Tracker</h1>
    <p>Enter your flags below to track your own progress.  
    Your progress is saved locally in your browser.</p>

    <button id="resetBtn" onclick="resetProgress()">Reset All Progress</button>

    <hr>

    <h2>Your Progress</h2>
    <p id="progressText"></p>
    <div style="background:#ddd; width:100%; height:20px; border-radius:5px; margin-bottom:20px;">
        <div id="progressBar" style="background:#4CAF50; height:100%; width:0%; border-radius:5px;"></div>
    </div>

    <h2>Submit Flags</h2>

    <div id="challenges"></div>
</div>

<script>
// All flags
const FLAGS = {
    "Challenge 1 — HTML Inspection": "flag{simple_ctf_html}",
    "Challenge 2 — JavaScript Password": "flag{simple_ctf_js}",
    "Challenge 3 — URL Manipulation": "flag{simple_ctf_param}",
    "Challenge 4 — Encoding": "flag{simple_ctf_encoding}",
    "Challenge 5 — robots.txt": "flag{simple_ctf_robots}",
    "Challenge 6 — Cookie Challenge": "flag{simple_ctf_cookie}",
    "Bonus — Reflected Input (XSS Awareness)": "flag{simple_ctf_bonus_xss}",
    "Bonus — Crypto Puzzle (ROT13)": "flag{simple_ctf_crypto}",
    "Bonus — SQL Injection Simulation": "flag{simple_ctf_sql}",
    "Bonus — MetaMind": "flag{simple_ctf_stego}",
    "Bonus — Log Analysis": "flag{simple_ctf_logs}",
    "Hard — MemoryBox": "flag{simple_ctf_memorybox}"
};

// Hints
const HINTS = {
    "Challenge 1 — HTML Inspection": "Hint: Right-click the page and select 'View Page Source' or 'Inspect'.",
    "Challenge 2 — JavaScript Password": "Hint: Check the JavaScript console. Functions need () to run.",
    "Challenge 3 — URL Manipulation": "Hint: Try changing URL parameters like role=user → role=admin.",
    "Challenge 4 — Encoding": "Hint: The flag is Base64-encoded.",
    "Challenge 5 — robots.txt": "Hint: Check /robots.txt for hidden files (remember: flag.html).",
    "Challenge 6 — Cookie Challenge": "Hint: Modify the 'role' cookie in DevTools → Application → Cookies.",
    "Bonus — Reflected Input (XSS Awareness)": "Hint: Try entering <script> to see how the page reacts.",
    "Bonus — Crypto Puzzle (ROT13)": "Hint: ROT13 shifts letters by 13. Use an online decoder.",
    "Bonus — SQL Injection Simulation": "Hint: Try entering: ' OR 1=1",
    "Bonus — MetaMind": "Hint: Images can contain hidden metadata beyond just pixels.",
    "Bonus — Log Analysis": "Hint: Find the repeated suspicious IP in the logs.",
    "Hard — MemoryBox": "Hint: This is a hard challenge designed to test all the knowledge you've gathered so far. There may also be a twist or something new to discover."
};

// Explanations
const EXPLANATIONS = {
    "Challenge 1 — HTML Inspection":
        "This challenge teaches you to inspect HTML source code. Secrets should never be stored in front-end code.",
    "Challenge 2 — JavaScript Password":
        "This teaches you that client-side password checks are insecure.",
    "Challenge 3 — URL Manipulation":
        "Never rely on URL parameters for permissions.",
    "Challenge 4 — Encoding":
        "Encoding is not encryption.",
    "Challenge 5 — robots.txt":
        "robots.txt is public and cannot protect sensitive data.",
    "Challenge 6 — Cookie Challenge":
        "Cookies can be modified — always validate server-side.",
    "Bonus — Reflected Input (XSS Awareness)":
        "Always sanitize user input.",
    "Bonus — Crypto Puzzle (ROT13)":
        "ROT13 is simple encoding, not security.",
    "Bonus — SQL Injection Simulation":
        "Use parameterized queries to prevent SQL injection.",
    "Bonus — MetaMind":
        "Files may contain hidden metadata.",
    "Bonus — Log Analysis":
        "Log forensics can reveal attack patterns.",
    "Hard — MemoryBox": 
        "This challenge is closer to what you might encounter in a real CTF. It combines multiple skills and encourages practical problem-solving."
};

// Load saved progress
let progress = JSON.parse(localStorage.getItem("ctf_progress")) || {};

function saveProgress() {
    localStorage.setItem("ctf_progress", JSON.stringify(progress));
    updateProgressDisplay();
}

function resetProgress() {
    localStorage.removeItem("ctf_progress");
    progress = {};
    location.reload();
}

function updateProgressDisplay() {
    let completed = Object.values(progress).filter(v => v === true).length;
    let total = Object.keys(FLAGS).length;

    document.getElementById("progressText").innerText =
        `Completed: ${completed} / ${total} challenges`;

    let percent = (completed / total) * 100;
    document.getElementById("progressBar").style.width = percent + "%";
}

// Build UI
const container = document.getElementById("challenges");

Object.keys(FLAGS).forEach(title => {
    const div = document.createElement("div");
    div.className = "challenge-box";

    div.innerHTML = `
        <strong>${title}</strong><br>
        <input id="input-${title}" placeholder="Enter flag" style="width:300px;">
        <button onclick="checkFlag('${title}')">Submit</button>
        <span id="result-${title}" style="margin-left:10px;"></span><br>

        <button onclick="toggleHint('${title}')" style="margin-top:5px;">Show Hint</button>
        <div id="hint-${title}" style="margin-top:5px; color:blue; display:none;"></div>

        <div id="explain-${title}" style="margin-top:10px; color:green; font-style:italic;"></div>
    `;

    container.appendChild(div);

    // Restore saved completion state
    if (progress[title] === true) {
        document.getElementById(`result-${title}`).innerHTML =
            "<span style='color:green;'>✔ Correct!</span>";

        document.getElementById(`explain-${title}`).innerText =
            EXPLANATIONS[title] || "";
    }
});

function checkFlag(title) {
    const inputField = document.getElementById(`input-${title}`);
    const resultField = document.getElementById(`result-${title}`);
    const explainField = document.getElementById(`explain-${title}`);

    if (inputField.value.trim() === FLAGS[title]) {
        resultField.innerHTML = "<span style='color:green;'>✔ Correct!</span>";
        explainField.innerText = EXPLANATIONS[title] || "";
        progress[title] = true;
        saveProgress();
    } else {
        resultField.innerHTML = "<span style='color:red;'>✖ Incorrect</span>";
        explainField.innerText = "";
    }
}

// NEW: toggle hint visibility
function toggleHint(title) {
    const hintField = document.getElementById(`hint-${title}`);
    if (hintField.style.display === "none") {
        hintField.innerText = HINTS[title];
        hintField.style.display = "block";
    } else {
        hintField.style.display = "none";
    }
}

updateProgressDisplay();
</script>
</body>
</html>
