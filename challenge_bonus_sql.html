<!DOCTYPE html>
<html>
<head>
    <title>Bonus Challenge — SQL Injection Simulation</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1>Bonus Challenge — SQL Injection Simulation</h1>
    <p>
        This is a safe, simulated login system. No real database exists.<br>
        Try entering something interesting as your username.
    </p>

    <input id="user" placeholder="username">
    <button onclick="login()">Login</button>

    <p id="result"></p>

<script>
    function login() {
        const user = document.getElementById("user").value.trim();

        // --- (1) FULL SQL INJECTION SUCCESS CONDITIONS ---
        const fullInjectionString = [
            "((['\"]?\\s*OR\\s+['\"]?\\d+['\"]?\\s*=\\s*['\"]?\\d+))",  // OR 1=1
            "(--|#|\\/\\*)",                                           // comments: -- # /*
            "(\\bUNION\\b\\s+\\bSELECT\\b)",                           // UNION SELECT
            "(\\bDROP\\b\\s+\\bTABLE\\b)",                             // DROP TABLE
            "(\\bDELETE\\b\\s+\\bFROM\\b)"                             // DELETE FROM
        ].join("|");
        const fullInjection = new RegExp(fullInjectionString, "i");


        // --- (2) SYNTAX-BREAKING INPUT (feedback to user) ---
        // Examples:
        // '   "   ''   "abc   abc'xyz   OR(1=1  ;;;   )(
        const syntaxBreakPattern =
            /(['"][^'"]*$)|(^[^'"]*['"]$)|(;{2,})|(\(\))|(\([^)]*$)|(^[^()]*\))|(\bOR\b\s*$)/i;


        // --- (3) BASIC INDICATORS THAT USER IS ON THE RIGHT TRACK---
        const sqliHints =
            /(('|\"|;|\bOR\b|\bAND\b|\bSELECT\b|\bUNION\b|\bWHERE\b))/i;


        // --- LOGIC ---

        // 1. Full SQL injection success → show flag
        if (fullInjection.test(user)) {
            document.getElementById("result").innerHTML =
                "Login bypassed!<br><strong>flag{simple_ctf_sql}</strong>";
            return;
        }

        // 2. Syntax-breaking attempt → tell user they are close
        if (syntaxBreakPattern.test(user)) {
            document.getElementById("result").innerHTML =
                "You've broken the SQL syntax — good!<br>" +
                "Now try turning it into a valid condition like:<br>" +
                "<code>' OR 1=1 --</code>";
            return;
        }

        // 3. General SQL-ish terms → hint they are on the right track
        if (sqliHints.test(user)) {
            document.getElementById("result").innerHTML =
                "You're on the right track…<br>" +
                "Try building a full injection, e.g.:<br>" +
                "<code>' OR 1=1 --</code>";
            return;
        }

        // 4. Normal incorrect input
        document.getElementById("result").innerText = "Invalid username.";
    }
</script>



</div>
</body>
</html>


